CREATE VIEW attendance_eligibility AS
SELECT 	stu_id, 
	course_code, 
	type, 
	COUNT(status)/15 *100 AS "80% Percentage",
	IF((COUNT(status)/15*100)>=80, "Eligible", "Not Eligible") AS "Eligibility"
FROM attendance
WHERE status = "Present" AND type IN ("Theory","Practical")
GROUP BY stu_id,course_code,type;





CREATE VIEW ca_marks AS
SELECT 
    stu_id,
    course_code,
    (
        COALESCE(CAST(quiz1 AS DECIMAL(5,2)), 0) * 0.10 + 
        COALESCE(CAST(quiz2 AS DECIMAL(5,2)), 0) * 0.10 + 
        COALESCE(CAST(quiz3 AS DECIMAL(5,2)), 0) * 0.10 + 
        COALESCE(CAST(assessment AS DECIMAL(5,2)), 0) * 0.20 + 
        COALESCE(CAST(mid_theory AS DECIMAL(5,2)), 0) * 0.25 + 
        COALESCE(CAST(mid_practical AS DECIMAL(5,2)), 0) * 0.25
    ) AS ca_mark
FROM 
    exam_marks;





CREATE VIEW overall_eligibility AS
SELECT 
    a.stu_id,
    a.course_code,
    a.type,
    CASE 
        WHEN a.Eligibility = "Eligible" AND c.ca_mark >= 40 THEN "Eligible"
        ELSE "Not Eligible"
    END AS eligibility_status
FROM 
    attendance_eligibility AS a
JOIN 
    ca_marks AS c 
ON 
    a.stu_id = c.stu_id 
    AND a.course_code = c.course_code;





INSERT INTO eligibility (stu_id, course_code, type, status)
SELECT 
    a.stu_id,
    a.course_code,
    a.type,
    CASE 
        WHEN a.Eligibility = "Eligible" AND c.ca_mark >= 40 THEN "Eligible"
        ELSE "Not Eligible"
    END AS eligibility_status
FROM 
    attendance_eligibility AS a
JOIN 
    ca_marks AS c 
ON 
    a.stu_id = c.stu_id 
    AND a.course_code = c.course_code
GROUP BY a.stu_id, a.course_code, a.type;
